<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="generator" content="Hexo 4.2.0"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><title>Install MongoDB Cluster - Tutorial</title><meta name="description" content="How to Install a MongoDB Sharded Cluster on CentOS 7Sharding is a MongoDB process to store data-set across different machines. It allows you to do a horizontal scale of data, partition data across ind"><meta property="og:type" content="article"><meta property="og:title" content="Install MongoDB Cluster"><meta property="og:url" content="https://tutorial.getmedik.co.id/install-mongodb-cluster/index.html"><meta property="og:site_name" content="Tutorial"><meta property="og:description" content="How to Install a MongoDB Sharded Cluster on CentOS 7Sharding is a MongoDB process to store data-set across different machines. It allows you to do a horizontal scale of data, partition data across ind"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://tutorial.getmedik.co.id/images/og_image.png"><meta property="article:published_time" content="2019-12-24T05:35:54.669Z"><meta property="article:modified_time" content="2020-01-06T07:35:26.293Z"><meta property="article:author" content="Harry"><meta property="article:tag" content="MongoDB"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://tutorial.getmedik.co.id/images/og_image.png"><link rel="icon" href="//cdn.jsdelivr.net/gh/harryarifin79/tutorial@gh-pages/images/favicon.svg"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.7.2/css/bulma.css"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.4.1/css/all.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu:400,600|Source+Code+Pro"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/harryarifin79/tutorial@gh-pages/css/back-to-top.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/harryarifin79/tutorial@gh-pages/css/progressbar.css"><script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/harryarifin79/tutorial@gh-pages/css/style.css"></head><body class="is-3-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand is-flex-center"><a class="navbar-item navbar-logo" href="/"><img src="//cdn.jsdelivr.net/gh/harryarifin79/tutorial@gh-pages/images/logo.svg" alt="Install MongoDB Cluster" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a> <a class="navbar-item" href="/archives">Archives</a> <a class="navbar-item" href="/categories">Categories</a> <a class="navbar-item" href="/tags">Tags</a> <a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column is-8-tablet is-8-desktop is-6-widescreen has-order-2 column-main"><div class="card"><div class="card-content article"><div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto"><div class="level-left"><time class="level-item has-text-grey" datetime="2019-12-24T05:35:54.669Z">2019-12-24</time><div class="level-item"><a class="has-link-grey -link" href="/categories/Install/">Install</a></div><span class="level-item has-text-grey">8 minutes read (About 1151 words)</span></div></div><h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">Install MongoDB Cluster</h1><div class="content"><h1 id="How-to-Install-a-MongoDB-Sharded-Cluster-on-CentOS-7"><a href="#How-to-Install-a-MongoDB-Sharded-Cluster-on-CentOS-7" class="headerlink" title="How to Install a MongoDB Sharded Cluster on CentOS 7"></a><strong>How to Install a MongoDB Sharded Cluster on CentOS 7</strong></h1><p><strong>Sharding</strong> is a MongoDB process to store data-set across different machines. It allows you to do a horizontal scale of data, partition data across independent instances, and it can be ‘Replica Sets’. Data-set partitioning on ‘Sharding’ uses shard key. Sharding allows you to add more machines based on data growth on your stack.</p><hr><a id="more"></a><h3 id="Sharding-and-Replication"><a href="#Sharding-and-Replication" class="headerlink" title="Sharding and Replication"></a><strong>Sharding and Replication</strong></h3><p>Let’s make it simple. When you have collections of music, ‘Sharding’ will save and keep your music collections into a different folder. ‘Replication,’ on the other hand, is just syncing your music collections to other instances.</p><hr><h3 id="Three-Sharding-Components"><a href="#Three-Sharding-Components" class="headerlink" title="Three Sharding Components"></a><strong>Three Sharding Components</strong></h3><p><strong>Shard</strong> - Used to store all data, and in a production environment, each shard is replica sets. Provides high-availability and data consistency.</p><hr><p><strong>Config Server</strong> - Used to store cluster metadata, contains a mapping of cluster data set and shards. This data is used by mongos/query server to deliver operations. It’s recommended to use more than 3 instances in production.</p><hr><p><strong>Mongos/Query Router</strong> - This is just mongo instances running as application interfaces. The application will make requests to mongos instances, and then mongos will deliver the requests using shard key to the shards replica sets.</p><hr><p><strong><center>Prerequisites</center></strong></p><ul><li><strong>3 centOS 7 server as Config, Shard, and Mongos/Query Router</strong><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">192.168.88.100      mongod1</span><br><span class="line">192.168.88.101      mongod2</span><br><span class="line">192.168.88.102      mongod3</span><br></pre></td></tr></table></figure></li><li><strong>PORT</strong><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">27017  mongos&#x2F;Query</span><br><span class="line">27018  Config Replica Set</span><br><span class="line">27019  Shard1 Replica Set</span><br><span class="line">27020  Shard2 Replica Set</span><br></pre></td></tr></table></figure></li><li><strong>Root privileges</strong></li><li><strong>Each server connected to another server</strong><h4 id="Step-1-Disable-SELinux-and-Configure-Hosts"><a href="#Step-1-Disable-SELinux-and-Configure-Hosts" class="headerlink" title="Step 1 - Disable SELinux and Configure Hosts"></a><strong><center>Step 1 - Disable SELinux and Configure Hosts</center></strong></h4>For this tutorial, we will disable SELinux. Change SELinux configuration from ‘enforcing’ to ‘disabled’.</li></ul><p>Connect to all nodes through OpenSSH.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh root@SERVERIP</span><br></pre></td></tr></table></figure><p>Disable SELinux by editing the configuration file.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim &#x2F;etc&#x2F;sysconfig&#x2F;selinux</span><br></pre></td></tr></table></figure><p>Change SELinux value to ‘disabled’.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELINUX&#x3D;disabled</span><br></pre></td></tr></table></figure><p>Save and exit.</p><p>Next, edit the hosts file on each server.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim &#x2F;etc&#x2F;hosts</span><br></pre></td></tr></table></figure><p>Paste the following hosts configuration:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">192.168.88.100      mongod1</span><br><span class="line">192.168.88.101      mongod2</span><br><span class="line">192.168.88.102      mongod3</span><br></pre></td></tr></table></figure><p>Save and exit.</p><p>Now restart all servers:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">reboot</span><br></pre></td></tr></table></figure><h3 id="Step-2-Install-MongoDB-on-All-Instances"><a href="#Step-2-Install-MongoDB-on-All-Instances" class="headerlink" title="Step 2 - Install MongoDB on All Instances"></a><strong><center>Step 2 - Install MongoDB on All Instances</center></strong></h3><p>We will use latest MongoDB (MongoDB 4.2) for all instances. Add new MongoDB repository by executing the following commands:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">cat &lt;&lt;&#39;EOF&#39; &gt;&gt; &#x2F;etc&#x2F;yum.repos.d&#x2F;mongodb.repo</span><br><span class="line">[mongodb-org-4.2]</span><br><span class="line">name&#x3D;MongoDB Repository</span><br><span class="line">baseurl&#x3D;https:&#x2F;&#x2F;repo.mongodb.org&#x2F;yum&#x2F;redhat&#x2F;$releasever&#x2F;mongodb-org&#x2F;4.2&#x2F;x86_64&#x2F;</span><br><span class="line">gpgcheck&#x3D;1</span><br><span class="line">enabled&#x3D;1</span><br><span class="line">gpgkey&#x3D;https:&#x2F;&#x2F;www.mongodb.org&#x2F;static&#x2F;pgp&#x2F;server-4.2.asc</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure><p>Now install mongodb 4.2 from mongodb repository using the yum command below.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum -y install mongodb-org</span><br></pre></td></tr></table></figure><p>After mongodb is installed, use ‘mongo’ or ‘mongod’ command in the following way to check version details.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mongod --version</span><br></pre></td></tr></table></figure><p>Install MongoDB on All Instances</p><h3 id="Step-3-Create-Config-Shard-Server-Replica-Sets-and-Mongos-Query-on-each-Server"><a href="#Step-3-Create-Config-Shard-Server-Replica-Sets-and-Mongos-Query-on-each-Server" class="headerlink" title="Step 3 - Create Config, Shard Server Replica Sets and Mongos/Query on each Server"></a><strong><center>Step 3 - Create Config, Shard Server Replica Sets and Mongos/Query on each Server</center></strong></h3><p>In the prerequisites section, we’ve already defined config server with 3 machines as a ‘configsvr’. And in this step, we will configure it to be a replica set.</p><p>If there is mongod service running on the server, stop it with the following systemctl command.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl stop mongod</span><br><span class="line">systemctl disable mongod</span><br></pre></td></tr></table></figure><p>copy mongod.conf</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cp &#x2F;etc&#x2F;mongod.conf &#x2F;home&#x2F;mongoconfig.conf</span><br><span class="line">cp &#x2F;etc&#x2F;mongod.conf &#x2F;home&#x2F;shard1.conf</span><br><span class="line">cp &#x2F;etc&#x2F;mongod.conf &#x2F;home&#x2F;shard2.conf</span><br><span class="line">cp &#x2F;etc&#x2F;mongod.conf &#x2F;home&#x2F;mongos.conf</span><br></pre></td></tr></table></figure><p><strong>open mongodb configuration ‘mongoconfig.conf’.</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim &#x2F;home&#x2F;mongoconfig.conf</span><br></pre></td></tr></table></figure><p>Change DB storage path to your own directory. We will use ‘/mongodb/mongoconfig/‘.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">systemLog:</span><br><span class="line">  destination: file</span><br><span class="line">  logAppend: true</span><br><span class="line">  path: &#x2F;mongodb&#x2F;mongoconfig&#x2F;log&#x2F;configsvr.log</span><br><span class="line">storage:</span><br><span class="line">   dbPath: &#x2F;mongodb&#x2F;mongoconfig&#x2F;data</span><br><span class="line">net:</span><br><span class="line">  port: 27018</span><br><span class="line">bindIP: 192.168.88.100,127.0.0.1</span><br><span class="line">replication:</span><br><span class="line">   replSetName: &quot;rs0&quot;</span><br><span class="line">sharding:</span><br><span class="line">   clusterRole: configsvr</span><br></pre></td></tr></table></figure><p>Save and exit.</p><p><strong>open mongodb configuration ‘shard1.conf’.</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim &#x2F;home&#x2F;shard1.conf</span><br></pre></td></tr></table></figure><p>Change DB storage path to your own directory. We will use ‘/mongodb/shard1/‘.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">systemLog:</span><br><span class="line">  destination: file</span><br><span class="line">  logAppend: true</span><br><span class="line">  path: &#x2F;mongodb&#x2F;shard&#x2F;log&#x2F;shard1.log</span><br><span class="line">storage:</span><br><span class="line">   dbPath: &#x2F;mongodb&#x2F;shard&#x2F;shard1&#x2F;data</span><br><span class="line">net:</span><br><span class="line">  port: 27019</span><br><span class="line">bindIP: 192.168.88.100,127.0.0.1</span><br><span class="line">replication:</span><br><span class="line">   replSetName: &quot;rs1&quot;</span><br><span class="line">sharding:</span><br><span class="line">   clusterRole: shardsvr</span><br></pre></td></tr></table></figure><p>Save and exit.</p><p><strong>open mongodb configuration ‘shard2.conf’.</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim &#x2F;home&#x2F;shard2.conf</span><br></pre></td></tr></table></figure><p>Change DB storage path to your own directory. We will use ‘/mongodb/shard2/‘.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">systemLog:</span><br><span class="line">  destination: file</span><br><span class="line">  logAppend: true</span><br><span class="line">  path: &#x2F;mongodb&#x2F;shard&#x2F;log&#x2F;shard2.log</span><br><span class="line">storage:</span><br><span class="line">   dbPath: &#x2F;mongodb&#x2F;shard&#x2F;shard2&#x2F;data</span><br><span class="line">net:</span><br><span class="line">  port: 27020</span><br><span class="line">bindIP: 192.168.88.100,127.0.0.1</span><br><span class="line">replication:</span><br><span class="line">   replSetName: &quot;rs2&quot;</span><br><span class="line">sharding:</span><br><span class="line">   clusterRole: shardsvr</span><br></pre></td></tr></table></figure><p>Save and exit.</p><p>open mongodb configuration ‘mongos.conf’.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim &#x2F;home&#x2F;mongos.conf</span><br></pre></td></tr></table></figure><p>No need data folder on mongos just log file. Command all the <strong>storage</strong> and <strong>replication</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">systemLog:</span><br><span class="line">  destination: file</span><br><span class="line">  logAppend: true</span><br><span class="line">  path: &#x2F;mongodb&#x2F;mongos&#x2F;log&#x2F;mongos.log</span><br><span class="line">net:</span><br><span class="line">  port: 27017</span><br><span class="line">bindIP: 192.168.88.100,127.0.0.1</span><br><span class="line">sharding:</span><br><span class="line">   configDB: rs0&#x2F;192.168.88.100:27018,192.168.88.101:27018,192.168.88.102:27018</span><br></pre></td></tr></table></figure><p>Save and exit.</p><p><strong>Create Folder</strong><br>Next, we must create a new directory for MongoDB data, and then change the ownership permissions of that directory to the ‘mongod’ user.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p &#x2F;mongodb&#x2F;mongoconfig&#x2F;log</span><br><span class="line">mkdir -p &#x2F;mongodb&#x2F;mongoconfig&#x2F;data</span><br><span class="line">mkdir -p &#x2F;mongodb&#x2F;shard&#x2F;log</span><br><span class="line">mkdir -p &#x2F;mongodb&#x2F;shard&#x2F;shard1&#x2F;data</span><br><span class="line">mkdir -p &#x2F;mongodb&#x2F;shard&#x2F;shard2&#x2F;data</span><br><span class="line">mkdir -p &#x2F;mongodb&#x2F;mongos&#x2F;log&#x2F;mongos.log</span><br><span class="line">chown -R mongod:mongod &#x2F;mongodb&#x2F;mongoconfig&#x2F;log</span><br><span class="line">chown -R mongod:mongod &#x2F;mongodb&#x2F;mongoconfig&#x2F;data</span><br><span class="line">chown -R mongod:mongod &#x2F;mongodb&#x2F;shard&#x2F;log</span><br><span class="line">chown -R mongod:mongod &#x2F;mongodb&#x2F;shard&#x2F;shard1&#x2F;data</span><br><span class="line">chown -R mongod:mongod &#x2F;mongodb&#x2F;shard&#x2F;shard2&#x2F;data</span><br><span class="line">chown -R mongod:mongod &#x2F;mongodb&#x2F;mongos&#x2F;log&#x2F;mongos.log</span><br></pre></td></tr></table></figure><p>Next, start the mongod service with the following command.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mongod --config &#x2F;home&#x2F;mongoconfig.conf</span><br><span class="line">mongod --config &#x2F;home&#x2F;shard1.conf</span><br><span class="line">mongod --config &#x2F;home&#x2F;shard2.conf</span><br><span class="line">mongos --config &#x2F;home&#x2F;mongos.conf</span><br></pre></td></tr></table></figure><p>You can check mongod service is running with the netstat command.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netstat -plntu</span><br></pre></td></tr></table></figure><p><strong>Repeat this step in all server</strong></p><h3 id="Step-4-Initiate-member-on-all-mongod"><a href="#Step-4-Initiate-member-on-all-mongod" class="headerlink" title="Step 4 - Initiate member on all mongod"></a><strong><center>Step 4 - Initiate member on all mongod</center></strong></h3><h5 id="Add-Config-Server-in-Replica-Set"><a href="#Add-Config-Server-in-Replica-Set" class="headerlink" title="Add Config Server in Replica Set"></a><strong>Add Config Server in Replica Set</strong></h5><p>Configsvr are ready for the replica set. Connect to the ‘mongod1’ server and access the mongo shell.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh root@mongod1</span><br><span class="line">mongo --port 27018</span><br></pre></td></tr></table></figure><p>Initiate the replica set name with all configsvr members using the query below.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">rs.initiate()</span><br><span class="line">rs.add(&quot;192.168.88.101:27018&quot;)</span><br><span class="line">rs.add(&quot;192.168.88.102:27018&quot;)</span><br></pre></td></tr></table></figure><p>If you get a results ‘{ “ok” : 1 }’, it means the configsvr is already configured with the replica set.</p><p>Initiate the replica set name with all configsvr members</p><p>and you will be able to see which node is master and which node is secondary.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rs.status()</span><br></pre></td></tr></table></figure><p>The configuration of Config Server Replica Set is done.</p><p>configuration of Config Server Replica Set</p><h5 id="Add-Shard-Server-in-Replica-Set"><a href="#Add-Shard-Server-in-Replica-Set" class="headerlink" title="Add Shard Server in Replica Set"></a><strong>Add Shard Server in Replica Set</strong></h5><p>Shard1 and Shard2 are ready for the replica set. Connect to the <strong>‘mongod1’</strong> server and access the mongo shell.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">mongo --port 27019</span><br><span class="line"></span><br><span class="line">Initiate the replica set name with all Shard1 members using the query below.</span><br><span class="line"></span><br><span class="line">rs.initiate()</span><br><span class="line">rs.add(&quot;192.168.88.101:27019&quot;)</span><br><span class="line">rs.add(&quot;192.168.88.102:27019&quot;)</span><br><span class="line">rs.status()</span><br><span class="line">exit</span><br><span class="line"></span><br><span class="line">mongo --port 27020</span><br><span class="line"></span><br><span class="line">Initiate the replica set name with all Shard2 members using the query below.</span><br><span class="line"></span><br><span class="line">rs.initiate()</span><br><span class="line">rs.add(&quot;192.168.88.101:27020&quot;)</span><br><span class="line">rs.add(&quot;192.168.88.102:27020&quot;)</span><br><span class="line">rs.status()</span><br><span class="line">exit</span><br></pre></td></tr></table></figure><p>If you get a results ‘{ “ok” : 1 }’, it means the Shard is already configured with the replica set.<br>Initiate the replica set name with all Shards members and you will be able to see which node is master and which node is secondary.</p><p>The configuration of Config Server Replica Set is done.</p><p>configuration of Shard Server Replica Set</p><h5 id="Add-Mongos-Member"><a href="#Add-Mongos-Member" class="headerlink" title="Add Mongos Member"></a><strong>Add Mongos Member</strong></h5><p><strong>Configure mongos/Query Router</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mongo --port 27017</span><br><span class="line"></span><br><span class="line">sh.addShard( &quot;rs1&#x2F;192.168.88.100:27019,192.168.88.101:27019,192.168.88.102:27019&quot;)</span><br><span class="line">sh.addShard( &quot;rs1&#x2F;192.168.88.100:27020,192.168.88.101:27020,192.168.88.102:27020&quot;)</span><br><span class="line">sh.status()</span><br></pre></td></tr></table></figure><p>MongoDB sharded cluster on CentOS 7 successfully installed and deployed.</p><p>reff<br><a href="https://www.howtoforge.com/tutorial/install-a-mongodb-sharded-cluster-on-centos-7/" target="_blank" target="_blank" target="_blank" target="_blank" rel="external nofollow noopener noreferrer">Howtoforge</a><br><a href="https://docs.mongodb.com/manual/tutorial/install-mongodb-on-red-hat/" target="_blank" target="_blank" target="_blank" target="_blank" rel="external nofollow noopener noreferrer">MongoDB</a></p></div><div class="level is-size-7 is-uppercase"><div class="level-start"><div class="level-item"><span class="is-size-6 has-text-grey has-mr-7">#</span> <a class="has-link-grey -link" href="/tags/MongoDB/" rel="tag">MongoDB</a></div></div></div></div></div><div class="card"><div class="card-content"><h3 class="menu-label has-text-centered">Like this article? Support the author with</h3><div class="buttons is-centered"><div class="notification is-danger">You forgot to set the <code>qrcode</code> for Alipay. Please set it in <code>_config.yml</code>.</div><div class="notification is-danger">You forgot to set the <code>qrcode</code> for Wechat. Please set it in <code>_config.yml</code>.</div><div class="notification is-danger">You forgot to set the <code>business</code> and <code>currency_code</code> for Paypal. Please set it in <code>_config.yml</code>.</div><div class="notification is-danger">You forgot to set the <code>url</code> Patreon. Please set it in <code>_config.yml</code>.</div></div></div></div><div class="card card-transparent"><div class="level post-navigation is-flex-wrap is-mobile"><div class="level-start"><a class="level level-item has-link-grey article-nav-prev" href="/install-zimbra/"><i class="level-item fas fa-chevron-left"></i> <span class="level-item">Install Zimbra Mail Server</span></a></div></div></div></div><div class="column is-4-tablet is-4-desktop is-3-widescreen has-order-1 column-left"><div class="card widget"><div class="card-content"><nav class="level"><div class="level-item has-text-centered" style="flex-shrink:1"><div><figure class="image is-128x128 has-mb-6"><img class="is-rounded" src="//cdn.jsdelivr.net/gh/harryarifin79/tutorial@gh-pages/images/avatar.png" alt="GetMedik"></figure><p class="is-size-4 is-block">GetMedik</p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">Posts</p><a href="/archives"><p class="title has-text-weight-normal">3</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Category</p><a href="/categories"><p class="title has-text-weight-normal">1</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Tags</p><a href="/tags"><p class="title has-text-weight-normal">2</p></a></div></div></nav><div class="level"><a class="level-item button is-link is-rounded" href="https://tutorial.getmedik.co.id" target="_blank" rel="noopener">Follow</a></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">Links</h3><ul class="menu-list"><li><a class="level is-mobile" href="https://tutorial.getmedik.co.id" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Tutorial</span> </span><span class="level-right"><span class="level-item tag">tutorial.getmedik.co.id</span></span></a></li><li><a class="level is-mobile" href="http://getmedik.co.id" target="_blank" target="_blank" target="_blank" target="_blank" rel="noopener external nofollow noopener noreferrer"><span class="level-left"><span class="level-item">GetMedik</span> </span><span class="level-right"><span class="level-item tag">getmedik.co.id</span></span></a></li></ul></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">Categories</h3><ul class="menu-list"><li><a class="level is-marginless" href="/categories/Install/"><span class="level-start"><span class="level-item">Install</span> </span><span class="level-end"><span class="level-item tag">3</span></span></a></li></ul></div></div></div><div class="card widget"><div class="card-content"><h3 class="menu-label">Tag Cloud</h3><a href="/tags/MongoDB/" style="font-size:20px">MongoDB</a> <a href="/tags/Zimbra/" style="font-size:10px">Zimbra</a></div></div><div class="column-right-shadow is-hidden-widescreen"><div class="card widget"><div class="card-content"><h3 class="menu-label">Recent</h3><article class="media"><a href="/install-ops-manager/" class="media-left"><p class="image is-64x64"><img class="thumbnail" src="//cdn.jsdelivr.net/gh/harryarifin79/tutorial@gh-pages/images/thumbnail.svg" alt="Install OpsManager MongoDb"></p></a><div class="media-content"><div class="content"><div><time class="has-text-grey is-size-7 is-uppercase" datetime="2020-01-07T11:18:05.246Z">2020-01-07</time></div><a href="/install-ops-manager/" class="title has-link-black-ter is-size-6 has-text-weight-normal">Install OpsManager MongoDb</a><p class="is-size-7 is-uppercase"><a class="has-link-grey -link" href="/categories/Install/">Install</a></p></div></div></article><article class="media"><a href="/install-zimbra/" class="media-left"><p class="image is-64x64"><img class="thumbnail" src="//cdn.jsdelivr.net/gh/harryarifin79/tutorial@gh-pages/images/thumbnail.svg" alt="Install Zimbra Mail Server"></p></a><div class="media-content"><div class="content"><div><time class="has-text-grey is-size-7 is-uppercase" datetime="2020-01-03T09:10:07.852Z">2020-01-03</time></div><a href="/install-zimbra/" class="title has-link-black-ter is-size-6 has-text-weight-normal">Install Zimbra Mail Server</a><p class="is-size-7 is-uppercase"><a class="has-link-grey -link" href="/categories/Install/">Install</a></p></div></div></article><article class="media"><a href="/install-mongodb-cluster/" class="media-left"><p class="image is-64x64"><img class="thumbnail" src="//cdn.jsdelivr.net/gh/harryarifin79/tutorial@gh-pages/images/thumbnail.svg" alt="Install MongoDB Cluster"></p></a><div class="media-content"><div class="content"><div><time class="has-text-grey is-size-7 is-uppercase" datetime="2019-12-24T05:35:54.669Z">2019-12-24</time></div><a href="/install-mongodb-cluster/" class="title has-link-black-ter is-size-6 has-text-weight-normal">Install MongoDB Cluster</a><p class="is-size-7 is-uppercase"><a class="has-link-grey -link" href="/categories/Install/">Install</a></p></div></div></article></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">Archives</h3><ul class="menu-list"><li><a class="level is-marginless" href="/archives/2020/01/"><span class="level-start"><span class="level-item">January 2020</span> </span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-marginless" href="/archives/2019/12/"><span class="level-start"><span class="level-item">December 2019</span> </span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">Tags</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/MongoDB/"><span class="tag">MongoDB</span> <span class="tag is-grey">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Zimbra/"><span class="tag">Zimbra</span> <span class="tag is-grey">1</span></a></div></div></div></div></div></div></div><div class="column is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only has-order-3 column-right"><div class="card widget"><div class="card-content"><h3 class="menu-label">Recent</h3><article class="media"><a href="/install-ops-manager/" class="media-left"><p class="image is-64x64"><img class="thumbnail" src="//cdn.jsdelivr.net/gh/harryarifin79/tutorial@gh-pages/images/thumbnail.svg" alt="Install OpsManager MongoDb"></p></a><div class="media-content"><div class="content"><div><time class="has-text-grey is-size-7 is-uppercase" datetime="2020-01-07T11:18:05.246Z">2020-01-07</time></div><a href="/install-ops-manager/" class="title has-link-black-ter is-size-6 has-text-weight-normal">Install OpsManager MongoDb</a><p class="is-size-7 is-uppercase"><a class="has-link-grey -link" href="/categories/Install/">Install</a></p></div></div></article><article class="media"><a href="/install-zimbra/" class="media-left"><p class="image is-64x64"><img class="thumbnail" src="//cdn.jsdelivr.net/gh/harryarifin79/tutorial@gh-pages/images/thumbnail.svg" alt="Install Zimbra Mail Server"></p></a><div class="media-content"><div class="content"><div><time class="has-text-grey is-size-7 is-uppercase" datetime="2020-01-03T09:10:07.852Z">2020-01-03</time></div><a href="/install-zimbra/" class="title has-link-black-ter is-size-6 has-text-weight-normal">Install Zimbra Mail Server</a><p class="is-size-7 is-uppercase"><a class="has-link-grey -link" href="/categories/Install/">Install</a></p></div></div></article><article class="media"><a href="/install-mongodb-cluster/" class="media-left"><p class="image is-64x64"><img class="thumbnail" src="//cdn.jsdelivr.net/gh/harryarifin79/tutorial@gh-pages/images/thumbnail.svg" alt="Install MongoDB Cluster"></p></a><div class="media-content"><div class="content"><div><time class="has-text-grey is-size-7 is-uppercase" datetime="2019-12-24T05:35:54.669Z">2019-12-24</time></div><a href="/install-mongodb-cluster/" class="title has-link-black-ter is-size-6 has-text-weight-normal">Install MongoDB Cluster</a><p class="is-size-7 is-uppercase"><a class="has-link-grey -link" href="/categories/Install/">Install</a></p></div></div></article></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">Archives</h3><ul class="menu-list"><li><a class="level is-marginless" href="/archives/2020/01/"><span class="level-start"><span class="level-item">January 2020</span> </span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-marginless" href="/archives/2019/12/"><span class="level-start"><span class="level-item">December 2019</span> </span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">Tags</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/MongoDB/"><span class="tag">MongoDB</span> <span class="tag is-grey">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Zimbra/"><span class="tag">Zimbra</span> <span class="tag is-grey">1</span></a></div></div></div></div></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start has-text-centered-mobile"><a class="footer-logo is-block has-mb-6" href="/"><img src="//cdn.jsdelivr.net/gh/harryarifin79/tutorial@gh-pages/images/logo.svg" alt="Install MongoDB Cluster" height="28"></a><p class="is-size-7">&copy; 2020 Harry&nbsp; Powered by <a href="https://hexo.io/" target="_blank" target="_blank" target="_blank" rel="noopener external nofollow noopener noreferrer">Hexo</a> & <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" target="_blank" target="_blank" rel="noopener external nofollow noopener noreferrer">Icarus</a></p></div><div class="level-end"></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script>moment.locale("en")</script><script>var IcarusThemeSettings={site:{url:"https://tutorial.getmedik.co.id",external_link:{enable:!0,exclude:[]}},article:{highlight:{clipboard:!0,fold:"unfolded"}}}</script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script src="//cdn.jsdelivr.net/gh/harryarifin79/tutorial@gh-pages/js/animation.js"></script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script><script src="//cdn.jsdelivr.net/gh/harryarifin79/tutorial@gh-pages/js/gallery.js" defer></script><div id="outdated"><h6>Your browser is out-of-date!</h6><p>Update your browser to view this website correctly. <a id="btnUpdateBrowser" href="http://outdatedbrowser.com/" target="_blank" target="_blank" target="_blank" rel="external nofollow noopener noreferrer">Update my browser now</a></p><p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">&times;</a></p></div><script src="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.js" defer></script><script>document.addEventListener("DOMContentLoaded",function(){outdatedBrowser({bgColor:"#f25648",color:"#ffffff",lowerThan:"flex"})})</script><script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.5/unpacked/MathJax.js?config=TeX-MML-AM_CHTML" defer></script><script>document.addEventListener("DOMContentLoaded",function(){MathJax.Hub.Config({"HTML-CSS":{matchFontHeight:!1},SVG:{matchFontHeight:!1},CommonHTML:{matchFontHeight:!1},tex2jax:{inlineMath:[["$","$"],["\\(","\\)"]]}})})</script><a id="back-to-top" title="Back to Top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="//cdn.jsdelivr.net/gh/harryarifin79/tutorial@gh-pages/js/back-to-top.js" defer></script><script src="//cdn.jsdelivr.net/gh/harryarifin79/tutorial@gh-pages/js/main.js" defer></script><div class="searchbox ins-search"><div class="searchbox-container ins-search-container"><div class="searchbox-input-wrapper"><input type="text" class="searchbox-input ins-search-input" placeholder="Type something..."> <span class="searchbox-close ins-close ins-selectable"><i class="fa fa-times-circle"></i></span></div><div class="searchbox-result-wrapper ins-section-wrapper"><div class="ins-section-container"></div></div></div></div><script>window.INSIGHT_CONFIG={TRANSLATION:{POSTS:"Posts",PAGES:"Pages",CATEGORIES:"Categories",TAGS:"Tags",UNTITLED:"(Untitled)"},CONTENT_URL:"/content.json"}</script><script src="//cdn.jsdelivr.net/gh/harryarifin79/tutorial@gh-pages/js/insight.js" defer></script><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/harryarifin79/tutorial@gh-pages/css/search.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/harryarifin79/tutorial@gh-pages/css/insight.css"></body></html>